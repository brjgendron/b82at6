<!DOCTYPE html>
<html>
  <head>
    <title>Chat.js</title>
    <!-- <style>
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
			#messages li:nth-child(odd) { background: #eee; }
			#sender { font-weight: bold; }
		</style> -->
		<link rel="stylesheet" href="stylesheets/reset.css">
		<link rel="stylesheet" href="stylesheets/chatbox.css">
		<link rel="stylesheet" href="stylesheets/messages.css">
		<link rel="stylesheet" href="stylesheets/variables.css">
	</head>
	
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script>
		$(function () {
			var socket = io();
			$('form').submit(function(e){
				e.preventDefault(); // prevents page reloading
				if ($("#chatbox").val().length > 0) {
					socket.emit('chat message', $('#chatbox').val());
					$('#chatbox').val('');
				}
				return false;
			});

			socket.on('chat message', function(msg, userID, time, color){
				$('#messages').append(
					$('<li>').append(
						$("<span>", {class : "time"}).text(`[${time}] `)
					).append(
						$("<span>", {class : userID}).text(`${userID}: `)
					).append(
						$("<span>", {class : "message-text"}).text(`${msg}`)
					)
				);

				$(`.${userID}`).css({"color":color});
				$(`.${userID}`).css({"font-weight":"500"});

				var messagesContainer = document.getElementById("messages-container");
				messagesContainer.scrollTop = messagesContainer.scrollHeight + 50;
			});

			socket.on("user disconnect", function(userID, color) {
				$('#messages').append(
					$('<li>').append(
						$("<span>").text("User ").append(
							$("<span>", {class : userID}).text(`${userID} `)
						).append(
							$("<span>").text("has left")
						)
					)
				);

				$(`.${userID}`).css({"color":color});
				$(`.${userID}`).css({"font-weight":"500"});
			});

			socket.on("user connect", function(userID, color) {
				$('#messages').append(
					$('<li>').append(
						$("<span>").text("User ").append(
							$("<span>", {class : userID}).text(`${userID} `)
						).append(
							$("<span>").text("has joined")
						)
					)
				);

				$(`.${userID}`).css({"color":color});
				$(`.${userID}`).css({"font-weight":"500"});
			});
		});
	</script>

	<body>
		<div id="messages-container">
			<ul id="messages"></ul>
		</div>

		<div id="chatbox-container">
			<form id="compose" action="">
				<input id="chatbox" autocomplete="off" placeholder="Write a message">
				<!-- <button id="send">Send</button> -->
			</form>
		</div>
	</body>
</html>